<!DOCTYPE html>
<html>
    <head>
        <title>EmuBox</title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    </head>

    <body>
        <h1 align="center">Welcome to EmuBox</h1>
        <h3 align="center">Please connect to one of the following with remote desktop.</h3>

        <table style="width:75%" border="1" cellpadding="5" cellspacing="5" align="center">
        <thead>
            <tr>
                <th style="text-align: center">Workshop Name</th>
                <th style="text-align: center">Number Available</th>
                <th style="text-align: center">Materials</th>
                <th style="text-align: center">Connection Link</th>
            </tr>
        </thead>
        <tbody>
        {% for workshop in workshops %}
            <tr>
                <td>
                    <div style="text-align: center"> {{ workshop.workshopName }} </div>
                </td>
                <td>
                    <div style="text-align: center"><span class="workshop_queue" id="{{ workshop.workshopName }}"></span> workshops available! </div>
                </td>
                <td>
                    {% for material in workshop.materials %}
                        <div style="text-align: center"> -<a href="{{ material[0] }}">{{ material[1] }} </a> <br/> </div>
                    {% endfor %}
                </td>
                <td>
                    <div id = "download_links_{{ workshop.workshopName }}">
                        <div id="ms_rdp_{{ workshop.workshopName }}" style="text-align: center">
                            Windows: <a href="/checkout/ms-rdp/{{ workshop.workshopName}}">MS-RDP</a>
                        </div>
                        <div id="rdesktop_{{ workshop.workshopName }}" style="text-align: center">
                            Linux: <a href="/checkout/rdesktop/{{ workshop.workshopName}}">rdesktop</a>
                        </div>
                    </div>
                </td>
            </tr>
        {% endfor %}
        </tbody>
        </table>

        <script>
            window.setInterval(updateStatuses, 1000); // Call function every second
            function updateStatuses() {
                    $(".workshop_queue").each(function() {
                        var $this = $(this)
                        var id = $(this).attr("id");
                        $.ajax({
                            url: "/getQueueSize/" + id,
                            dataType: "json",
                            success: function(response) {
                                var s = "download_links_" + id;
                                if (response === 0)
                                    $('#' + s).hide();
                                else
                                    $('#' + s).show();
                                $this.text(response);
                                $this.text();
                            }
                        });
                    });
            }
        </script>
    </body>
</html>
